{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Scan Results{% endblock %}

{% block extra_css %}
<style>
    :root {
        --cyber-black: #0A0E1A;
        --cyber-blue: #00D4FF;
        --cyber-green: #00FF88;
        --cyber-purple: #8B5CF6;
        --cyber-red: #FF0040;
        --dark-gray: #1A1F2E;
        --light-gray: #2A3441;
        --text-primary: #FFFFFF;
        --text-secondary: #B8C5D8;
    }

    .result-container {
        max-width: 1200px;
        margin: 120px auto 60px;
        padding: 0 20px;
        position: relative;
        z-index: 1;
    }
    
    .result-container::before {
        content: '';
        position: absolute;
        top: -50px;
        left: 0;
        width: 100%;
        height: 300px;
        background: radial-gradient(ellipse at top, rgba(0, 212, 255, 0.15), transparent 70%);
        pointer-events: none;
        z-index: -1;
    }

    .cyber-title {
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 900;
        margin-bottom: 20px;
        background: linear-gradient(135deg, var(--cyber-blue) 0%, var(--cyber-green) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-transform: uppercase;
        letter-spacing: 3px;
        text-shadow: 0 0 20px var(--cyber-blue);
        text-align: center;
    }

    .cyber-subtitle {
        color: var(--text-secondary);
        font-size: 1.2rem;
        text-align: center;
        margin-bottom: 40px;
        font-family: 'Courier New', monospace;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
    }

    .cyber-card {
        background: rgba(26, 31, 46, 0.8);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.1);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        height: 100%;
    }

    .cyber-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 255, 136, 0.15);
        border-color: var(--cyber-green);
    }

    .card-title {
        color: var(--cyber-blue);
        font-family: 'Courier New', monospace;
        font-weight: 600;
        margin-bottom: 25px;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-size: 1.25rem;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        position: relative;
        display: inline-block;
    }
    
    .card-title::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 50%;
        height: 2px;
        background: linear-gradient(90deg, var(--cyber-blue), transparent);
    }

    .cyber-list {
        background: rgba(10, 14, 26, 0.6);
        border-radius: 8px;
        overflow: hidden;
    }

    .cyber-list-item {
        padding: 12px 15px;
        border-bottom: 1px solid rgba(0, 212, 255, 0.15);
        transition: all 0.3s ease;
        background: rgba(26, 31, 46, 0.6);
    }

    .cyber-list-item:last-child {
        border-bottom: none;
    }

    .cyber-list-item:hover {
        background: rgba(0, 212, 255, 0.05);
        transform: translateX(5px);
    }

    .item-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-family: 'Courier New', monospace;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .item-value {
        color: var(--text-primary);
        font-family: 'Courier New', monospace;
        font-weight: 600;
        text-align: right;
        word-break: break-word;
    }

    .status-alert {
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }

    .status-alert.safe {
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid rgba(0, 255, 136, 0.3);
    }

    .status-alert.danger {
        background: rgba(255, 0, 64, 0.1);
        border: 1px solid rgba(255, 0, 64, 0.3);
    }

    .status-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .status-title.safe {
        color: var(--cyber-green);
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    .status-title.danger {
        color: var(--cyber-red);
        text-shadow: 0 0 10px rgba(255, 0, 64, 0.5);
    }

    .status-score {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .url-box {
        background: rgba(10, 14, 26, 0.8);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .url-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 10px;
        font-family: 'Courier New', monospace;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .url-value {
        color: var(--cyber-blue);
        font-family: 'Courier New', monospace;
        word-break: break-all;
        font-size: 1rem;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        transition: all 0.3s ease;
    }

    .url-value:hover {
        color: var(--cyber-green);
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    .metric-box {
        background: rgba(10, 14, 26, 0.6);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
    }

    .metric-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 212, 255, 0.15);
        border-color: var(--cyber-green);
    }

    .metric-icon {
        font-size: 1.75rem;
        margin-bottom: 10px;
        color: var(--cyber-blue);
        text-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
    }

    .metric-value {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 5px;
        color: var(--cyber-green);
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
    }

    .metric-label {
        color: var(--text-secondary);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Courier New', monospace;
    }

    .btn-cyber {
        background: transparent !important;
        border: 2px solid var(--cyber-blue) !important;
        color: var(--cyber-blue) !important;
        font-family: 'Courier New', monospace !important;
        text-transform: uppercase !important;
        letter-spacing: 1px !important;
        padding: 12px 20px !important;
        font-weight: 600 !important;
        transition: all 0.3s ease !important;
        position: relative !important;
        overflow: hidden !important;
        z-index: 1 !important;
        border-radius: 8px !important;
        font-size: 0.9rem !important;
    }

    .btn-cyber::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--cyber-blue);
        opacity: 0.1;
        transition: left 0.3s ease;
        z-index: -1;
    }

    .btn-cyber:hover::before {
        left: 0;
    }

    .btn-cyber:hover {
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.4) !important;
        transform: translateY(-3px) !important;
        color: var(--cyber-blue) !important;
    }

    .badge-cyber {
        background: rgba(10, 14, 26, 0.6);
        border: 1px solid;
        font-family: 'Courier New', monospace;
        font-weight: 500;
        font-size: 0.75rem;
        padding: 5px 10px;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge-success {
        color: var(--cyber-green);
        border-color: var(--cyber-green);
        background: rgba(0, 255, 136, 0.1);
    }

    .badge-danger {
        color: var(--cyber-red);
        border-color: var(--cyber-red);
        background: rgba(255, 0, 64, 0.1);
    }

    .badge-info {
        color: var(--cyber-blue);
        border-color: var(--cyber-blue);
        background: rgba(0, 212, 255, 0.1);
    }

    .screenshot-container {
        max-height: 500px;
        overflow: hidden;
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 8px;
        margin-top: 20px;
        background: rgba(10, 14, 26, 0.5);
        position: relative;
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }
    
    .cyber-screenshot {
        width: 100%;
        height: auto;
        max-height: 450px;
        object-fit: contain;
        transition: transform 0.3s ease;
        padding: 10px;
        background: rgba(10, 14, 26, 0.7);
        border: 1px solid rgba(0, 212, 255, 0.1);
        margin: 0 auto;
        display: block;
    }
    
    .cyber-screenshot:hover {
        transform: scale(1.02);
        box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
    }
    
    .screenshot-terminal-header {
        background: rgba(26, 31, 46, 0.9);
        padding: 8px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(0, 212, 255, 0.2);
    }

    .terminal-controls {
        display: flex;
        gap: 6px;
    }
    
    .terminal-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
    }
    
    .terminal-dot:nth-child(1) {
        background: rgba(255, 59, 48, 0.7);
    }
    
    .terminal-dot:nth-child(2) {
        background: rgba(255, 204, 0, 0.7);
    }
    
    .terminal-dot:nth-child(3) {
        background: rgba(52, 199, 89, 0.7);
    }
    
    .terminal-title {
        color: var(--cyber-blue);
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        letter-spacing: 1px;
    }
    
    .terminal-info {
        color: var(--text-secondary);
        font-size: 0.8rem;
        font-family: 'Courier New', monospace;
    }

    /* Scan Overlay Styles */
    .scan-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(10, 14, 26, 0.95);
        z-index: 9999;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-family: 'Courier New', monospace;
    }
    
    .scan-overlay.active {
        display: flex;
    }
    
    .scan-status {
        color: var(--cyber-blue);
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 30px;
        text-align: center;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
    }
    
    .scan-dots {
        animation: dots 1.5s infinite;
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
    }
    
    .scan-progress {
        width: 400px;
        height: 4px;
        background: rgba(0, 212, 255, 0.2);
        border-radius: 2px;
        margin-bottom: 30px;
        overflow: hidden;
        position: relative;
    }
    
    .scan-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--cyber-blue), var(--cyber-green));
        border-radius: 2px;
        animation: progress-fill 5s ease-in-out infinite;
        position: relative;
    }
    
    .scan-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: progress-shine 2s infinite;
    }
    
    .scan-log {
        width: 600px;
        max-width: 90vw;
        height: 200px;
        background: rgba(10, 14, 26, 0.8);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 8px;
        padding: 15px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }
    
    .scan-log-content {
        height: 100%;
    }
    
    .scan-log-line {
        margin: 0 0 8px 0;
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.3s ease;
        color: var(--text-secondary);
    }
    
    .scan-log-line.active {
        opacity: 1;
        transform: translateX(0);
        color: var(--cyber-green);
    }
    
    .scan-log-line::before {
        content: '> ';
        color: var(--cyber-blue);
        font-weight: bold;
    }
    
    .scan-grid {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: 50px 50px;
        background-image: 
            linear-gradient(to right, rgba(0, 212, 255, 0.05) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(0, 212, 255, 0.05) 1px, transparent 1px);
        z-index: -1;
        opacity: 0.3;
    }
    
    @keyframes glitch {
        0%, 100% {
            text-shadow: 
                -1px -1px 0 rgba(0, 255, 136, 0.7),
                1px 1px 0 rgba(255, 0, 64, 0.7);
            transform: translate(0);
        }
        25% {
            text-shadow: 
                1px 1px 0 rgba(0, 255, 136, 0.7),
                -1px -1px 0 rgba(255, 0, 64, 0.7);
            transform: translate(1px, -1px);
        }
        50% {
            text-shadow: 
                -1px 1px 0 rgba(0, 255, 136, 0.7),
                1px -1px 0 rgba(255, 0, 64, 0.7);
            transform: translate(-1px, 1px);
        }
        75% {
            text-shadow: 
                1px -1px 0 rgba(0, 255, 136, 0.7),
                -1px 1px 0 rgba(255, 0, 64, 0.7);
            transform: translate(1px, 1px);
        }
    }
    
    @keyframes scan-progress {
        0% { width: 0%; left: 0; }
        50% { width: 100%; left: 0; }
        50.1% { width: 100%; left: auto; right: 0; }
        100% { width: 0%; left: auto; right: 0; }
    }
    
    @keyframes dots {
        0% { width: 0em; }
        100% { width: 1.25em; }
    }
    
    @keyframes progress-fill {
        0% { width: 0%; }
        15% { width: 15%; }
        25% { width: 25%; }
        40% { width: 40%; }
        45% { width: 45%; }
        60% { width: 60%; }
        75% { width: 75%; }
        85% { width: 85%; }
        95% { width: 95%; }
        100% { width: 100%; }
    }
    
    @keyframes progress-shine {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(200%); }
    }
</style>
{% endblock %}


{% block content %}
<div class="result-container">
            <!-- Header -->
    <h1 class="cyber-title">URL Analysis Results</h1>
    <p class="cyber-subtitle">Advanced security analysis with machine learning detection</p>

            <!-- URL Card -->
    <div class="url-box">
        <div class="row">
            <div class="col-lg-8 mb-3 mb-lg-0">
                <div class="url-label">Analyzed URL</div>
                <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="url-value">
                            {{ url }}
                            <i class="fas fa-external-link-alt ms-2 small"></i>
                        </a>
                    </div>
            <div class="col-lg-4 d-flex align-items-end justify-content-lg-end">
                {% if report_path %}
                    {% if report_path|slice:"-4:" == ".pdf" %}
                        <a href="/media/{{ report_path }}" class="btn btn-cyber" download>
                            <i class="fas fa-file-pdf me-2"></i>Download PDF Report
                        </a>
                    {% else %}
                        <a href="/media/{{ report_path }}" class="btn btn-cyber" target="_blank">
                            <i class="fas fa-file-code me-2"></i>View HTML Report
                        </a>
                    {% endif %}
                {% else %}
                    <button class="btn btn-cyber" onclick="generateReport()" id="generateReportBtn">
                        <i class="fas fa-file-pdf me-2"></i>Generate Report
                    </button>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Main Result -->
    <div class="status-alert {% if is_phishing %}danger{% else %}safe{% endif %}">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="status-title {% if is_phishing %}danger{% else %}safe{% endif %}">
                    <i class="fas {% if is_phishing %}fa-exclamation-triangle{% else %}fa-shield-alt{% endif %} me-2"></i>
                            {% if is_phishing %}
                                Potential Phishing Website Detected
                            {% else %}
                                Safe Website
                            {% endif %}
                </h2>
                <div class="status-score">
                                Confidence Score: <strong>{{ confidence|floatformat:1 }}/10</strong>
                            {% if from_cache %}
                    <span class="badge-cyber badge-info ms-3">Cached Result</span>
                            {% endif %}
                        </div>
                    </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <form method="post" action="{% url 'scan' %}" id="rescanForm">
                    {% csrf_token %}
                    <input type="hidden" name="url" value="{{ url }}">
                    <input type="hidden" name="force_rescan" value="true">
                    <button type="submit" class="btn btn-cyber" id="rescanButton">
                        <i class="fas fa-sync-alt me-2"></i>Rescan URL
                        <div class="scan-loader"></div>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Security Metrics -->
    <div class="row g-4 mb-4">
        <div class="col-md-3 col-6">
            <div class="metric-box">
                <div class="metric-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="metric-value">{{ confidence|floatformat:1 }}/10</div>
                <div class="metric-label">Security Score</div>
            </div>
                                </div>
        <div class="col-md-3 col-6">
            <div class="metric-box">
                <div class="metric-icon">
                    <i class="fas {% if analysis.security_info.uses_https|default:False %}fa-lock{% else %}fa-lock-open{% endif %}"></i>
                            </div>
                <div class="metric-value">
                    {% if analysis.security_info.uses_https|default:False %}
                        Secure
                    {% else %}
                        Not Secure
                    {% endif %}
                </div>
                <div class="metric-label">HTTPS Status</div>
                                </div>
                            </div>
        <div class="col-md-3 col-6">
            <div class="metric-box">
                <div class="metric-icon">
                                    <i class="fas fa-certificate"></i>
                </div>
                <div class="metric-value">
                    {% if analysis.ssl_info.has_expired|default:False %}
                        Expired
                    {% else %}
                        Valid
                    {% endif %}
                </div>
                <div class="metric-label">SSL Certificate</div>
                                </div>
                            </div>
        <div class="col-md-3 col-6">
            <div class="metric-box">
                <div class="metric-icon">
                                    <i class="fas fa-link"></i>
                                </div>
                <div class="metric-value">{{ analysis.content_info.external_links|default:"0" }}</div>
                <div class="metric-label">External Links</div>
                        </div>
                    </div>
                </div>

    <!-- Debug Information (temporary) -->
    <div class="cyber-card mb-4">
        <h3 class="card-title">Debug Information</h3>
        <div class="cyber-list">
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">Report Path</div>
                    <div class="item-value">{{ report_path|default:"Not Available" }}</div>
                </div>
            </div>
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">Report Type</div>
                    <div class="item-value">
                        {% if report_path %}
                            {% if report_path|slice:"-4:" == ".pdf" %}
                                PDF Report
                            {% elif report_path|slice:"-5:" == ".html" %}
                                HTML Report
                            {% else %}
                                Unknown Format
                            {% endif %}
                        {% else %}
                            No Report Generated
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">Analysis Object</div>
                    <div class="item-value">{{ analysis|yesno:"Available,Not Available" }}</div>
                </div>
            </div>
            {% if analysis %}
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">Domain Info</div>
                    <div class="item-value">{{ analysis.domain_info|yesno:"Available,Not Available" }}</div>
                </div>
            </div>
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">Security Info</div>
                    <div class="item-value">{{ analysis.security_info|yesno:"Available,Not Available" }}</div>
                </div>
            </div>
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">Content Info</div>
                    <div class="item-value">{{ analysis.content_info|yesno:"Available,Not Available" }}</div>
                </div>
            </div>
            <div class="cyber-list-item">
                <div class="d-flex justify-content-between">
                    <div class="item-label">SSL Info</div>
                    <div class="item-value">{{ analysis.ssl_info|yesno:"Available,Not Available" }}</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Raw Data Display (for debugging) -->
    <div class="cyber-card mb-4">
        <h3 class="card-title">Raw Analysis Data</h3>
        <div class="cyber-list">
            <div class="cyber-list-item">
                <pre style="color: var(--text-secondary); font-size: 0.8rem; white-space: pre-wrap;">{{ analysis|pprint }}</pre>
            </div>
        </div>
    </div>

    <!-- Analysis Cards -->
    <div class="row g-4">
                <!-- Domain Information -->
        <div class="col-lg-6">
            <div class="cyber-card">
                <h3 class="card-title">
                    <i class="fas fa-globe me-2"></i>Domain Information
                </h3>
                <div class="cyber-list">
                                {% if analysis.domain_info %}
                                    {% if analysis.domain_info.note %}
                            <div class="cyber-list-item">
                                <i class="fas fa-info-circle me-2" style="color: var(--cyber-blue);"></i>{{ analysis.domain_info.note }}
                                        </div>
                                    {% endif %}
                                    
                                    {% for key, value in analysis.domain_info.items %}
                                        {% if value and key != 'note' and key != 'error' %}
                            <div class="cyber-list-item">
                                <div class="d-flex justify-content-between">
                                    <div class="item-label">{{ key|title|replace:"_" }}</div>
                                    <div class="item-value">
                                                    {% if key == 'name_servers' and value|length > 1 %}
                                                        <ul class="list-unstyled mb-0">
                                                            {% for server in value %}
                                                                <li>{{ server }}</li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% else %}
                                                        {{ value }}
                                                    {% endif %}
                                    </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                    
                                    {% if analysis.domain_info.error %}
                            <div class="cyber-list-item" style="color: var(--cyber-red);">
                                            <i class="fas fa-exclamation-circle me-2"></i>{{ analysis.domain_info.error }}
                                        </div>
                                    {% endif %}
                                {% else %}
                        <div class="cyber-list-item text-center py-4">
                            <i class="fas fa-info-circle mb-3" style="font-size: 2rem; color: var(--text-secondary);"></i>
                            <p class="mb-0" style="color: var(--text-secondary);">No domain information available</p>
                                    </div>
                                {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Security Information -->
        <div class="col-lg-6">
            <div class="cyber-card">
                <h3 class="card-title">
                    <i class="fas fa-shield-alt me-2"></i>Security Analysis
                </h3>
                <div class="cyber-list">
                                {% if analysis.security_info %}
                                    {% for key, value in analysis.security_info.items %}
                            {% if value is not None %}
                            <div class="cyber-list-item">
                                <div class="d-flex justify-content-between">
                                    <div class="item-label">{{ key|title|replace:"_" }}</div>
                                    <div class="item-value">
                                        <span class="badge-cyber {% if value %}badge-success{% else %}badge-danger{% endif %}">
                                                    {{ value|yesno:"Yes,No" }}
                                                </span>
                                            </div>
                                        </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <div class="cyber-list-item text-center py-4">
                            <i class="fas fa-shield-alt mb-3" style="font-size: 2rem; color: var(--text-secondary);"></i>
                            <p class="mb-0" style="color: var(--text-secondary);">No security information available</p>
                        </div>
                    {% endif %}
                </div>
                    </div>
                </div>

                <!-- SSL Certificate -->
        <div class="col-lg-6">
            <div class="cyber-card">
                <h3 class="card-title">
                    <i class="fas fa-lock me-2"></i>SSL Certificate
                </h3>
                <div class="cyber-list">
                                {% if analysis.ssl_info %}
                                    {% for key, value in analysis.ssl_info.items %}
                            {% if value and key != 'error' %}
                            <div class="cyber-list-item">
                                <div class="d-flex justify-content-between">
                                    <div class="item-label">{{ key|title|replace:"_" }}</div>
                                    <div class="item-value">
                                                    {% if key == 'issuer' or key == 'subject' %}
                                                        {% for k, v in value.items %}
                                                            {{ k }}={{ v }}{% if not forloop.last %}, {% endif %}
                                                        {% endfor %}
                                                    {% else %}
                                                        {{ value }}
                                                    {% endif %}
                                    </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                        
                        {% if analysis.ssl_info.error %}
                        <div class="cyber-list-item" style="color: var(--cyber-red);">
                            <i class="fas fa-exclamation-circle me-2"></i>{{ analysis.ssl_info.error }}
                        </div>
                        {% endif %}
                                {% else %}
                        <div class="cyber-list-item text-center py-4">
                            <i class="fas fa-lock mb-3" style="font-size: 2rem; color: var(--text-secondary);"></i>
                            <p class="mb-0" style="color: var(--text-secondary);">No SSL certificate information available</p>
                        </div>
                                {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Content Analysis -->
        <div class="col-lg-6">
            <div class="cyber-card">
                <h3 class="card-title">
                    <i class="fas fa-file-alt me-2"></i>Content Analysis
                </h3>
                <div class="cyber-list">
                                {% if analysis.content_info %}
                                    {% for key, value in analysis.content_info.items %}
                            {% if value and key != 'error' %}
                            <div class="cyber-list-item">
                                <div class="d-flex justify-content-between">
                                    <div class="item-label">{{ key|title|replace:"_" }}</div>
                                    <div class="item-value">{{ value }}</div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                        
                        {% if analysis.content_info.error %}
                        <div class="cyber-list-item" style="color: var(--cyber-red);">
                            <i class="fas fa-exclamation-circle me-2"></i>{{ analysis.content_info.error }}
                        </div>
                        {% endif %}
                                {% else %}
                        <div class="cyber-list-item text-center py-4">
                            <i class="fas fa-file-alt mb-3" style="font-size: 2rem; color: var(--text-secondary);"></i>
                            <p class="mb-0" style="color: var(--text-secondary);">No content information available</p>
                        </div>
                                {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Screenshot -->
                {% if analysis.screenshot_path %}
                <div class="col-12">
            <div class="cyber-card">
                <h3 class="card-title">
                    <i class="fas fa-image me-2"></i>Website Screenshot
                </h3>
                            <div class="screenshot-container">
                    <div class="screenshot-terminal-header">
                        <div class="terminal-controls">
                            <span class="terminal-dot"></span>
                            <span class="terminal-dot"></span>
                            <span class="terminal-dot"></span>
                        </div>
                        <div class="terminal-title">Website Preview</div>
                        <div class="terminal-info">{{ analysis.domain_info.domain|default:"Unknown Domain" }}</div>
                    </div>
                    <img src="/media/{{ analysis.screenshot_path }}" alt="Website Screenshot" class="img-fluid cyber-screenshot" onerror="this.style.display='none'; this.parentElement.innerHTML += '<div class=\'alert alert-warning\'><i class=\'fas fa-exclamation-triangle me-2\'></i>Screenshot not available</div>';">
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Scan Overlay -->
<div class="scan-overlay" id="scanOverlay">
    <div class="scan-grid"></div>
    <div class="scan-status">
        <span id="scanStatusText">Initiating Scan</span>
        <span class="scan-dots">...</span>
    </div>
    
    <div class="scan-progress">
        <div class="scan-progress-bar"></div>
    </div>
    
    <div class="scan-log">
        <div class="scan-log-content" id="scanLogContent">
            <!-- Log lines will be added dynamically -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate cards on load
    const cards = document.querySelectorAll('.cyber-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
            card.style.transition = 'all 0.4s ease-out';
        }, index * 100);
    });
    
    // Add hover effects to metric boxes
    document.querySelectorAll('.metric-box').forEach(box => {
        box.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 10px 30px rgba(0, 212, 255, 0.2)';
        });
        
        box.addEventListener('mouseleave', function() {
            this.style.transform = '';
            this.style.boxShadow = '';
        });
    });
    
    // Rescan button animation handling
    const rescanForm = document.getElementById('rescanForm');
    const rescanButton = document.getElementById('rescanButton');
    const scanOverlay = document.getElementById('scanOverlay');
    const scanLogContent = document.getElementById('scanLogContent');
    const scanStatusText = document.getElementById('scanStatusText');
    
    // Log messages for the scanning animation
    const scanLogMessages = [
        "Establishing secure connection...",
        "Extracting URL features...",
        "Analyzing domain information...",
        "Checking DNS records...",
        "Inspecting SSL certificate...",
        "Analyzing website content...",
        "Examining JavaScript patterns...",
        "Detecting redirection attempts...",
        "Checking for obfuscated code...",
        "Processing through ML model...",
        "Analyzing URL structure...",
        "Checking for suspicious patterns...",
        "Comparing with known threats...",
        "Generating security score...",
        "Finalizing analysis results..."
    ];
    
    // Clear existing log content
    function clearLogContent() {
        scanLogContent.innerHTML = '';
    }
    
    // Add a log line with typing effect
    function addLogLine(text, delay) {
        const logLine = document.createElement('p');
        logLine.className = 'scan-log-line';
        logLine.textContent = text;
        
        // If we have too many lines, remove the oldest one
        const existingLines = scanLogContent.querySelectorAll('.scan-log-line');
        if (existingLines.length >= 5) {
            scanLogContent.removeChild(existingLines[0]);
        }
        
        scanLogContent.appendChild(logLine);
        
        setTimeout(() => {
            logLine.classList.add('active');
        }, delay);
    }
    
    // Start the scan animation
    function startScanAnimation() {
        // Show overlay with animation
        scanOverlay.classList.add('active');
        clearLogContent();
        
        // Add initial log line
        addLogLine("Initializing security scan...", 100);
        
        // Show scanning status messages in sequence
        let statusMessages = ["Initiating Scan", "Processing URL", "Running Analysis", "Detecting Threats", "Generating Report"];
        let currentStatus = 0;
        
        const statusInterval = setInterval(() => {
            scanStatusText.textContent = statusMessages[currentStatus];
            currentStatus = (currentStatus + 1) % statusMessages.length;
        }, 2000);
        
        // Add log lines with controlled timing
        let messageIndex = 0;
        const messageInterval = setInterval(() => {
            if (messageIndex < scanLogMessages.length) {
                addLogLine(scanLogMessages[messageIndex], 10);
                messageIndex++;
            } else {
                clearInterval(messageInterval);
            }
        }, 400);
        
        // Stop the animation after 5-6 seconds - form will submit naturally
        setTimeout(() => {
            clearInterval(statusInterval);
        }, 5000);
    }
    
    // Rescan button click handler
    if (rescanForm) {
        rescanForm.addEventListener('submit', function(e) {
            // Prevent default form submission
            e.preventDefault();
            
            // Add scanning class to button
            if (rescanButton) {
                rescanButton.classList.add('scanning');
            }
            
            // Start the scan animation
            startScanAnimation();
            
            // Submit the form after animation
            setTimeout(() => {
                // Remove scanning class
                if (rescanButton) {
                    rescanButton.classList.remove('scanning');
                }
                // Submit the form
                rescanForm.submit();
            }, 6000);
        });
    }
    
    // Report generation function
    window.generateReport = function() {
        const generateBtn = document.getElementById('generateReportBtn');
        const originalText = generateBtn.innerHTML;
        
        // Show loading state
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
        generateBtn.disabled = true;
        
        // Get CSRF token from meta tag or form
        let csrfToken = '';
        const csrfMeta = document.querySelector('meta[name=csrf-token]');
        if (csrfMeta) {
            csrfToken = csrfMeta.getAttribute('content');
        } else {
            const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfInput) {
                csrfToken = csrfInput.value;
            }
        }
        
        // Make AJAX call to generate report
        fetch('/api/analyze-url/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({
                url: '{{ url }}'
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.report_path) {
                // Report generated successfully
                if (data.report_path.endsWith('.pdf')) {
                    // Download PDF
                    window.location.href = '/media/' + data.report_path;
                } else {
                    // Open HTML report in new tab
                    window.open('/media/' + data.report_path, '_blank');
                }
                // Update button to show success
                generateBtn.innerHTML = '<i class="fas fa-check me-2"></i>Report Generated';
                setTimeout(() => {
                    generateBtn.innerHTML = originalText;
                    generateBtn.disabled = false;
                }, 2000);
            } else {
                // Show error message
                alert('Report generation failed. Please try again.');
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        })
        .catch(error => {
            console.error('Error generating report:', error);
            alert('Report generation failed. Please try again.');
            generateBtn.innerHTML = originalText;
            generateBtn.disabled = false;
        });
    };
});
</script>
{% endblock %}